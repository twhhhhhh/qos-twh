<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S6 ICT - Revision (Sorting Algo. & Data Structure) 排序算法與數據結構</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --bg: #f4f6f7;
            --card-bg: #ffffff;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--bg); color: #333; }
        
        /* Layout */
        header { background: var(--primary); color: white; padding: 1rem; text-align: center; }
        nav { background: #34495e; padding: 10px; display: flex; justify-content: center; gap: 10px; }
        nav button { background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        nav button.active, nav button:hover { background: var(--accent); border-color: var(--accent); }

        .main-container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        .module { display: none; }
        .module.active { display: block; }

        .card { background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; color: var(--primary); }
        h3 { color: #555; margin-top: 0; }

        /* Inputs & Buttons */
        input[type="text"], input[type="number"] { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100px; }
        input.code-input { width: 60px; font-family: monospace; color: var(--accent); font-weight: bold; text-align: center; }
        button.action-btn { background-color: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        button.action-btn:hover { background-color: #2980b9; }
        button.check-btn { background-color: var(--success); margin-left: 10px; }

        /* Code Block */
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; line-height: 1.8; }
        
        /* Feedback */
        .feedback { margin-top: 10px; font-weight: bold; }
        .correct { color: var(--success); }
        .incorrect { color: #c0392b; }

        /* Visualization Elements (Imported Styles) */
        .array-display { display: flex; gap: 5px; margin: 10px 0; justify-content: center; flex-wrap: wrap; }
        .array-item { width: 40px; height: 40px; border: 1px solid #999; display: flex; align-items: center; justify-content: center; background: #eee; font-weight: bold; border-radius: 4px; position: relative; }
        .array-item .idx { position: absolute; bottom: -18px; font-size: 0.7em; color: #666; }
        
        .stack-container { display: flex; flex-direction: column-reverse; width: 60px; border: 2px solid #333; border-top: none; min-height: 100px; margin: 0 auto; padding: 5px; background: #fff;}
        .stack-item { background: var(--accent); color: white; text-align: center; padding: 5px; margin-bottom: 2px; border-radius: 2px; animation: popIn 0.3s; }

        .queue-viz { display: flex; gap: 2px; border: 1px dashed #ccc; padding: 10px; justify-content: center; }
        .queue-cell { width: 50px; height: 50px; border: 1px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: #fff; }
        .queue-label { font-size: 0.7em; color: red; position: absolute; top: -15px; width: 100%; text-align: center; font-weight: bold; }
        
        .ll-node { display: inline-flex; align-items: center; margin: 5px; padding: 8px; border: 1px solid #333; background: #fff; border-radius: 4px; }
        .ll-arrow { margin: 0 5px; font-weight: bold; color: var(--accent); }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<header>
    <h1>S6 ICT - Revision (Sorting Algo. & Data Structure) 排序算法與數據結構</h1>
</header>

<nav>
    <button class="active" onclick="switchModule('sorting')">1. 排序算法 (Sorting)</button>
    <button onclick="switchModule('ds')">2. 數據結構 (Data Structures)</button>
</nav>

<div class="main-container">

    <div id="sorting" class="module active">
        <div class="card">
            <h2>課題學習目標</h2>
            <ul>
                <li>理解冒泡、選擇及插入排序的 Python 實作細節。</li>
                <li>能夠追蹤算法執行過程，預測第 $i$ 次循環後的陣列狀態。</li>
            </ul>
        </div>

        <div style="margin-bottom: 15px;">
            <select id="sortAlgoSelect" onchange="loadSortExercise()" style="padding: 8px; font-size: 1rem;">
                <option value="bubble">冒泡排序 (Bubble Sort)</option>
                <option value="selection">選擇排序 (Selection Sort)</option>
                <option value="insertion">插入排序 (Insertion Sort)</option>
            </select>
        </div>

        <div class="card">
            <h3>練習 A: Python 程式碼填空</h3>
            <p>請填入正確的變數、運算符或邊界值。</p>
            <div id="codeExerciseContainer"></div>
            <button class="action-btn check-btn" onclick="checkCode()">檢查答案</button>
            <div id="codeFeedback" class="feedback"></div>
        </div>

        <div class="card">
            <h3>練習 B: 算法追蹤 (Dry Run)</h3>
            <p>觀察初始陣列，並寫出指定循環次數後的陣列狀態 (以逗號分隔，例如: 1, 2, 3, 4)。</p>
            <div style="background: #eee; padding: 10px; border-radius: 4px; text-align: center; margin-bottom: 15px;">
                <strong>初始陣列: </strong> <span id="traceInitialArray" style="font-family: monospace; font-size: 1.2em;"></span>
            </div>
            <p id="traceQuestionText"></p>
            <input type="text" id="traceInput" placeholder="例如: 10, 20, 5, 8" style="width: 300px;">
            <button class="action-btn check-btn" onclick="checkTrace()">提交</button>
            <button class="action-btn" onclick="generateNewTrace()" style="margin-left: 5px; background-color: #7f8c8d;">下一題</button>
            <div id="traceFeedback" class="feedback"></div>
        </div>
    </div>

    <div id="ds" class="module">
        <div class="card">
            <h2>課題學習目標</h2>
            <ul>
                <li>堆疊 (Stack): 預測 Push/Pop 操作後的內容。</li>
                <li>循環隊列 (Circular Queue): 追蹤 Head 與 Tail 指標的位置。</li>
                <li>鏈表 (Linked List): 理解插入與刪除節點後的結構變化。</li>
            </ul>
        </div>

        <div style="margin-bottom: 15px;">
            <button class="action-btn" onclick="loadDS('stack')">堆疊 (Stack)</button>
            <button class="action-btn" onclick="loadDS('queue')">循環隊列 (Queue)</button>
            <button class="action-btn" onclick="loadDS('ll')">鏈表 (Linked List)</button>
        </div>

        <div id="ds-content-stack" class="ds-section" style="display:none;">
            <div class="card">
                <h3>堆疊狀態預測</h3>
                <p>執行以下操作後，堆疊由下至上的內容是什麼？(Top 在最右邊，以逗號分隔)</p>
                <div style="background: #e8f6f3; padding: 15px; border-left: 5px solid var(--accent);">
                    <strong>操作序列:</strong> <span id="stackOps"></span>
                </div>
                <br>
                <input type="text" id="stackAns" placeholder="例如: 5, 10">
                <button class="action-btn check-btn" onclick="checkStack()">檢查</button>
                <button class="action-btn" onclick="genStackQuiz()" style="background-color: #7f8c8d;">新題目</button>
                <div id="stackFeedback" class="feedback"></div>
                
                <hr>
                <h4>視覺化驗證區</h4>
                <div class="stack-container" id="stackViz"></div>
            </div>
        </div>

        <div id="ds-content-queue" class="ds-section" style="display:none;">
            <div class="card">
                <h3>循環隊列指針追蹤</h3>
                <p>隊列大小 (Max Size) 為 <strong>5</strong>。初始為空 (Head=-1, Tail=-1)。</p>
                <div style="background: #e8f6f3; padding: 15px; border-left: 5px solid var(--accent);">
                    <strong>操作序列:</strong> <span id="queueOps"></span>
                </div>
                <br>
                Head 索引: <input type="number" id="qHeadAns" style="width: 60px;"> 
                Tail 索引: <input type="number" id="qTailAns" style="width: 60px;">
                <button class="action-btn check-btn" onclick="checkQueue()">檢查</button>
                <button class="action-btn" onclick="genQueueQuiz()" style="background-color: #7f8c8d;">新題目</button>
                <div id="queueFeedback" class="feedback"></div>

                <hr>
                <h4>視覺化驗證區</h4>
                <div id="queueViz" class="queue-viz"></div>
            </div>
        </div>

        <div id="ds-content-ll" class="ds-section" style="display:none;">
            <div class="card">
                <h3>鏈表操作預測</h3>
                <p>觀察下圖鏈表，回答操作後的問題。</p>
                <div id="llVizInit" style="margin: 20px 0;"></div>
                <div style="background: #e8f6f3; padding: 15px; border-left: 5px solid var(--accent);">
                    <strong>操作:</strong> <span id="llOp"></span>
                </div>
                <br>
                <span id="llQuestion">結果鏈表順序為 (逗號分隔):</span>
                <input type="text" id="llAns" placeholder="例如: 10, 30" style="width: 200px;">
                <button class="action-btn check-btn" onclick="checkLL()">檢查</button>
                <button class="action-btn" onclick="genLLQuiz()" style="background-color: #7f8c8d;">新題目</button>
                <div id="llFeedback" class="feedback"></div>
            </div>
        </div>

    </div>

</div>

<script>
    // --- Navigation Logic ---
    function switchModule(modId) {
        document.querySelectorAll('.module').forEach(el => el.classList.remove('active'));
        document.getElementById(modId).classList.add('active');
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        
        if(modId === 'sorting') loadSortExercise();
        if(modId === 'ds') loadDS('stack');
    }

    function loadDS(type) {
        document.querySelectorAll('.ds-section').forEach(el => el.style.display = 'none');
        document.getElementById('ds-content-' + type).style.display = 'block';
        if(type === 'stack') genStackQuiz();
        if(type === 'queue') genQueueQuiz();
        if(type === 'll') genLLQuiz();
    }

    // ==========================================
    // MODULE 1: SORTING LOGIC
    // ==========================================
    
    const sortData = {
        bubble: {
            code: `def bubble_sort(arr):
   #將陣列由小至大排列
    n = len(arr)
    for i in range(<input class="code-input" data-ans="n" id="c1">):
        # 優化: 每次內層循環後，最大的元素已就位
        for j in range(0, <input class="code-input" data-ans="n-i-1" id="c2">):
            # 比較相鄰元素
            if arr[j] <input class="code-input" data-ans=">" id="c3"> arr[j+1]:
                # 交換位置
                arr[j], arr[j+1] = arr[j+1], arr[j]`,
            traceFunc: (arr, passes) => {
                let a = [...arr];
                let n = a.length;
                for(let i=0; i<passes; i++) {
                    for(let j=0; j<n-i-1; j++) {
                        if(a[j] > a[j+1]) [a[j], a[j+1]] = [a[j+1], a[j]];
                    }
                }
                return a;
            },
            name: "冒泡排序"
        },
        selection: {
            code: `def selection_sort(arr):
    for i in range(len(arr)):
        min_idx = i
        # 在未排序區間尋找最小值的索引
        for j in range(<input class="code-input" data-ans="i+1" id="c1">, len(arr)):
            if arr[j] <input class="code-input" data-ans="<" id="c2"> arr[min_idx]:
                min_idx = <input class="code-input" data-ans="j" id="c3">
        # 將找到的最小值交換到當前位置 i
        arr[i], arr[min_idx] = arr[min_idx], arr[i]`,
            traceFunc: (arr, passes) => {
                let a = [...arr];
                for(let i=0; i<passes; i++) {
                    let min_idx = i;
                    for(let j=i+1; j<a.length; j++) {
                        if(a[j] < a[min_idx]) min_idx = j;
                    }
                    [a[i], a[min_idx]] = [a[min_idx], a[i]];
                }
                return a;
            },
            name: "選擇排序"
        },
        insertion: {
            code: `def insertion_sort(arr):
    # 從第二個元素開始
    for i in range(1, len(arr)):
        key = arr[i]
        j = i - 1
        # 將大於 key 的元素向右移動
        while j >= 0 and key <input class="code-input" data-ans="<" id="c1"> arr[j]:
            arr[<input class="code-input" data-ans="j+1" id="c2">] = arr[j]
            j -= 1
        # 插入 key
        arr[j+1] = <input class="code-input" data-ans="key" id="c3">`,
            traceFunc: (arr, passes) => {
                // Passes in insertion sort usually correspond to the outer loop iterations
                let a = [...arr];
                for (let i = 1; i <= passes && i < a.length; i++) {
                    let key = a[i];
                    let j = i - 1;
                    while (j >= 0 && key < a[j]) {
                        a[j + 1] = a[j];
                        j--;
                    }
                    a[j + 1] = key;
                }
                return a;
            },
            name: "插入排序"
        }
    };

    let currentSortTrace = { arr: [], answer: [] };

    function loadSortExercise() {
        const type = document.getElementById('sortAlgoSelect').value;
        const data = sortData[type];
        
        // Load Code
        document.getElementById('codeExerciseContainer').innerHTML = `<pre>${data.code}</pre>`;
        document.getElementById('codeFeedback').textContent = "";
        
        // Load Trace
        generateNewTrace();
    }

    function checkCode() {
        let correct = true;
        document.querySelectorAll('.code-input').forEach(input => {
            const userVal = input.value.replace(/\s/g, ''); // remove spaces
            const ans = input.dataset.ans;
            if(userVal !== ans) {
                input.style.borderColor = "red";
                correct = false;
            } else {
                input.style.borderColor = "#27ae60";
            }
        });
        const fb = document.getElementById('codeFeedback');
        fb.textContent = correct ? "全對！做得好！" : "部分答案不正確，請檢查紅框處。";
        fb.className = correct ? "feedback correct" : "feedback incorrect";
    }

    function generateNewTrace() {
        const type = document.getElementById('sortAlgoSelect').value;
        const arr = Array.from({length: 6}, () => Math.floor(Math.random() * 50) + 1);
        const passes = Math.floor(Math.random() * 2) + 2; // Random 2 or 3 passes

        currentSortTrace.arr = [...arr];
        currentSortTrace.answer = sortData[type].traceFunc(arr, passes);

        document.getElementById('traceInitialArray').textContent = `[${arr.join(', ')}]`;
        
        let qText = "";
        if(type === 'insertion') {
             qText = `當外部迴圈執行了 ${passes} 次後 (即處理完第 ${passes+1} 個元素後)，陣列內容為何？`;
        } else {
             qText = `當外部迴圈執行完第 ${passes} 次 (i=${passes-1}) 後，陣列內容為何？`;
        }
        document.getElementById('traceQuestionText').textContent = qText;
        document.getElementById('traceInput').value = "";
        document.getElementById('traceFeedback').textContent = "";
    }

    function checkTrace() {
        const input = document.getElementById('traceInput').value;
        const userArr = input.split(/,| /).filter(x => x !== '').map(Number);
        
        const fb = document.getElementById('traceFeedback');
        // Simple array comparison
        if (JSON.stringify(userArr) === JSON.stringify(currentSortTrace.answer)) {
            fb.textContent = "正確！你完全掌握了算法的流程。";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `不正確。正確答案應該是: ${currentSortTrace.answer.join(', ')}`;
            fb.className = "feedback incorrect";
        }
    }


    // ==========================================
    // MODULE 2: DATA STRUCTURES LOGIC
    // ==========================================

    // --- STACK ---
    let stackQuizData = {};
    function genStackQuiz() {
        let stack = [];
        let ops = [];
        let opsDesc = [];
        const numOps = 5;

        for(let i=0; i<numOps; i++) {
            if(stack.length > 0 && Math.random() > 0.6) {
                stack.pop();
                ops.push("Pop");
                opsDesc.push("Pop");
            } else {
                let val = Math.floor(Math.random() * 20) + 1;
                stack.push(val);
                ops.push(`Push(${val})`);
                opsDesc.push(`Push ${val}`);
            }
        }
        stackQuizData = { finalStack: stack, ops: ops };
        document.getElementById('stackOps').innerHTML = opsDesc.join(' <span style="color:#aaa">➔</span> ');
        document.getElementById('stackAns').value = "";
        document.getElementById('stackFeedback').textContent = "";
        document.getElementById('stackViz').innerHTML = ""; // Clear viz
    }

    function checkStack() {
        const input = document.getElementById('stackAns').value;
        const userArr = input.split(/,| /).filter(x => x !== '').map(Number);
        const fb = document.getElementById('stackFeedback');
        
        // Viz
        const viz = document.getElementById('stackViz');
        viz.innerHTML = "";
        stackQuizData.finalStack.forEach(val => {
            let d = document.createElement('div');
            d.className = 'stack-item';
            d.textContent = val;
            viz.appendChild(d);
        });

        if (JSON.stringify(userArr) === JSON.stringify(stackQuizData.finalStack)) {
            fb.textContent = "正確！";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。正確堆疊狀態為: [${stackQuizData.finalStack.join(', ')}]`;
            fb.className = "feedback incorrect";
        }
    }

    // --- QUEUE ---
    let queueQuizData = {};
    function genQueueQuiz() {
        const size = 5;
        let head = -1, tail = -1;
        let count = 0;
        let opsDesc = [];
        let q = new Array(size).fill(null);

        // Simulate
        for(let i=0; i<6; i++) {
            let isEnqueue = Math.random() > 0.4;
            if (isEnqueue && count < size) {
                let val = Math.floor(Math.random() * 99);
                if (head === -1) { head = 0; tail = 0; }
                else { tail = (tail + 1) % size; }
                q[tail] = val;
                count++;
                opsDesc.push(`Enqueue(${val})`);
            } else if (!isEnqueue && count > 0) {
                q[head] = null;
                if (head === tail) { head = -1; tail = -1; }
                else { head = (head + 1) % size; }
                count--;
                opsDesc.push(`Dequeue`);
            }
        }

        queueQuizData = { h: head, t: tail, q: q, size: size };
        document.getElementById('queueOps').innerHTML = opsDesc.join(' <span style="color:#aaa">➔</span> ');
        document.getElementById('qHeadAns').value = "";
        document.getElementById('qTailAns').value = "";
        document.getElementById('queueFeedback').textContent = "";
        document.getElementById('queueViz').innerHTML = "";
    }

    function checkQueue() {
        const uH = parseInt(document.getElementById('qHeadAns').value);
        const uT = parseInt(document.getElementById('qTailAns').value);
        const fb = document.getElementById('queueFeedback');

        // Draw Viz
        const viz = document.getElementById('queueViz');
        viz.innerHTML = "";
        for(let i=0; i<queueQuizData.size; i++) {
            let cell = document.createElement('div');
            cell.className = 'queue-cell';
            cell.textContent = queueQuizData.q[i] !== null ? queueQuizData.q[i] : "";
            
            // Add grey background for empty
            if(queueQuizData.q[i] === null) cell.style.background = "#f4f4f4";

            let lbl = "";
            if(i === queueQuizData.h) lbl += "H ";
            if(i === queueQuizData.t) lbl += "T";
            if(lbl) cell.innerHTML += `<div class="queue-label">${lbl}</div>`;
            
            cell.innerHTML += `<div style="position:absolute; bottom:2px; font-size:10px; color:#aaa;">${i}</div>`;
            viz.appendChild(cell);
        }

        if (uH === queueQuizData.h && uT === queueQuizData.t) {
            fb.textContent = "正確！你清楚指針的移動規則。";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。Head 應為 ${queueQuizData.h}，Tail 應為 ${queueQuizData.t}。`;
            if(queueQuizData.h === -1) fb.textContent += " (隊列為空)";
            fb.className = "feedback incorrect";
        }
    }

    // --- LINKED LIST ---
    let llQuizData = {};
    function genLLQuiz() {
        let arr = [10, 20, 30, 40, 50];
        // Render Initial Viz
        const viz = document.getElementById('llVizInit');
        viz.innerHTML = arr.map(v => `<div class="ll-node">${v}</div>`).join('<span class="ll-arrow">➔</span>');

        let opType = Math.random() > 0.5 ? 'del' : 'ins';
        let question = "", ans = [];

        if (opType === 'del') {
            const delVal = arr[Math.floor(Math.random() * arr.length)];
            question = `刪除數值為 ${delVal} 的節點`;
            ans = arr.filter(x => x !== delVal);
        } else {
            const insVal = 99;
            const idx = Math.floor(Math.random() * (arr.length + 1));
            // simplified logic: insert at index
            question = `在索引 ${idx} (第 ${idx+1} 個位置) 插入數值 99`;
            let temp = [...arr];
            temp.splice(idx, 0, 99);
            ans = temp;
        }

        llQuizData = { ans: ans };
        document.getElementById('llOp').textContent = question;
        document.getElementById('llAns').value = "";
        document.getElementById('llFeedback').textContent = "";
    }

    function checkLL() {
        const input = document.getElementById('llAns').value;
        const userArr = input.split(/,| /).filter(x => x !== '').map(Number);
        const fb = document.getElementById('llFeedback');

        if (JSON.stringify(userArr) === JSON.stringify(llQuizData.ans)) {
            fb.textContent = "正確！";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。正確鏈表: ${llQuizData.ans.join(' ➔ ')}`;
            fb.className = "feedback incorrect";
        }
    }

    // Init
    loadSortExercise();

</script>

</body>
</html>