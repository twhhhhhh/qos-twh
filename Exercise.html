<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S6 ICT - Revision (Sorting Algo. & Data Structure) 排序算法與數據結構</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --bg: #f4f6f7;
            --card-bg: #ffffff;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--bg); color: #333; }
        
        /* Layout */
        header { background: var(--primary); color: white; padding: 1rem; text-align: center; }
        nav { background: #34495e; padding: 10px; display: flex; justify-content: center; gap: 10px; }
        nav button { background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        nav button.active, nav button:hover { background: var(--accent); border-color: var(--accent); }

        .main-container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        .module { display: none; }
        .module.active { display: block; }

        .card { background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; color: var(--primary); }
        h3 { color: #555; margin-top: 0; }
        h4 { color: var(--accent); margin-bottom: 5px;}

        /* Inputs & Buttons */
        input[type="text"], input[type="number"] { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100px; }
        input.code-input { width: 60px; font-family: monospace; color: var(--accent); font-weight: bold; text-align: center; }
        button.action-btn { background-color: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        button.action-btn:hover { background-color: #2980b9; }
        button.check-btn { background-color: var(--success); margin-left: 10px; }

        /* Code Block */
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; line-height: 1.8; }
        
        /* Feedback */
        .feedback { margin-top: 10px; font-weight: bold; }
        .correct { color: var(--success); }
        .incorrect { color: #c0392b; }

        /* Visualization Elements */
        .stack-wrapper { display: flex; gap: 50px; justify-content: center; align-items: flex-end; margin-top: 20px;}
        .stack-box { text-align: center; }
        .stack-container { display: flex; flex-direction: column-reverse; width: 70px; border: 3px solid #333; border-top: none; min-height: 150px; margin: 0 auto; padding: 5px; background: #fff;}
        .stack-item { background: var(--accent); color: white; text-align: center; padding: 8px; margin-bottom: 2px; border-radius: 2px; font-weight: bold; border: 1px solid rgba(0,0,0,0.2); }
        .stack-label { font-weight: bold; margin-top: 5px; display: block;}

        .ll-viz-container { display: flex; flex-wrap: wrap; align-items: center; gap: 5px; padding: 20px; overflow-x: auto;}
        .ll-node { display: flex; border: 2px solid #333; border-radius: 6px; background: #fff; overflow: hidden; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        .ll-data { padding: 10px 15px; font-weight: bold; font-size: 1.1em; color: var(--primary); border-right: 1px solid #999; }
        .ll-ptr { padding: 10px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 0.8em; color: #666; min-width: 20px;}
        .ll-arrow { font-size: 1.5em; color: var(--accent); font-weight: bold; margin: 0 5px; }
        .ll-null { font-weight: bold; color: #c0392b; font-family: monospace; font-size: 1.2em;}

        .diff-selector { margin-bottom: 15px; padding: 10px; background: #ecf0f1; border-radius: 5px; border-left: 5px solid var(--warning); }
        
        .queue-viz { display: flex; gap: 2px; border: 1px dashed #ccc; padding: 10px; justify-content: center; margin-top: 10px; }
        .queue-cell { width: 50px; height: 50px; border: 1px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: #fff; }
        .queue-label { font-size: 0.7em; color: red; position: absolute; top: -15px; width: 100%; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>S6 ICT - Revision (Sorting Algo. & Data Structure) 排序算法與數據結構</h1>
</header>

<nav>
    <button class="active" onclick="switchModule('sorting')">1. 排序算法 (Sorting)</button>
    <button onclick="switchModule('ds')">2. 數據結構 (Data Structures)</button>
</nav>

<div class="main-container">

    <div id="sorting" class="module active">
        <div class="card">
            <h2>課題 1: 排序算法</h2>
            <p>請選擇算法進行 Python 程式碼填空與乾跑 (Dry Run) 練習。</p>
            <select id="sortAlgoSelect" onchange="loadSortExercise()" style="padding: 8px; font-size: 1rem; margin-bottom: 10px;">
                <option value="bubble">冒泡排序 (Bubble Sort)</option>
                <option value="selection">選擇排序 (Selection Sort)</option>
                <option value="insertion">插入排序 (Insertion Sort)</option>
            </select>
        </div>

        <div class="card">
            <h3>練習 A: Python 程式碼填空</h3>
            <div id="codeExerciseContainer"></div>
            <button class="action-btn check-btn" onclick="checkCode()">檢查答案</button>
            <div id="codeFeedback" class="feedback"></div>
        </div>

        <div class="card">
            <h3>練習 B: 算法追蹤 (Dry Run)</h3>
            <p>點擊「下一題」可生成新的隨機陣列。</p>
            <div style="background: #eee; padding: 10px; border-radius: 4px; text-align: center; margin-bottom: 15px;">
                <strong>初始陣列: </strong> <span id="traceInitialArray" style="font-family: monospace; font-size: 1.2em; color: blue;"></span>
            </div>
            <p id="traceQuestionText" style="font-weight: bold;"></p>
            <input type="text" id="traceInput" placeholder="例如: 10, 20, 5, 8" style="width: 300px;">
            <button class="action-btn check-btn" onclick="checkTrace()">提交</button>
            <button class="action-btn" onclick="generateNewTrace()" style="margin-left: 5px; background-color: #7f8c8d;">下一題</button>
            <div id="traceFeedback" class="feedback"></div>
        </div>
    </div>

    <div id="ds" class="module">
        <div class="card">
            <h2>課題 2: 數據結構</h2>
            <div style="margin-bottom: 15px;">
                <button class="action-btn" onclick="loadDS('stack')">堆疊 (Stack)</button>
                <button class="action-btn" onclick="loadDS('ll')">鏈表 (Linked List)</button>
                <button class="action-btn" onclick="loadDS('queue')">循環隊列 (Queue)</button>
            </div>
        </div>

        <div id="ds-content-stack" class="ds-section" style="display:none;">
            <div class="card">
                <h3>堆疊算法挑戰</h3>
                
                <div class="diff-selector">
                    <strong>選擇難度：</strong>
                    <select id="stackDiffSelect" onchange="genStackQuiz()">
                        <option value="1">Level 1: 基礎 Push/Pop 狀態預測</option>
                        <option value="2">Level 2: 雙堆疊傳送 (Two Stacks)</option>
                        <option value="3">Level 3: 堆疊過濾算法 (Stack Algorithm)</option>
                    </select>
                </div>

                <div style="background: #e8f6f3; padding: 15px; border-left: 5px solid var(--accent); margin-bottom: 15px;">
                    <h4 id="stackQTitle">題目說明</h4>
                    <p id="stackQText">題目內容...</p>
                    <div id="stackInitState" style="margin-top:10px; font-family: monospace;"></div>
                </div>

                <label>你的答案 (由 Stack <strong>底部至頂部</strong>，逗號分隔):</label><br>
                <input type="text" id="stackAns" placeholder="例如: 5, 10, 20" style="width: 250px;">
                <button class="action-btn check-btn" onclick="checkStack()">檢查</button>
                <button class="action-btn" onclick="genStackQuiz()" style="background-color: #7f8c8d;">下一題 (刷新數值)</button>
                
                <div id="stackFeedback" class="feedback"></div>
                
                <hr>
                <h4>視覺化結果 (Answer Visualization)</h4>
                <div class="stack-wrapper" id="stackViz"></div>
            </div>
        </div>

        <div id="ds-content-ll" class="ds-section" style="display:none;">
            <div class="card">
                <h3>鏈表操作 (無索引概念)</h3>
                <p>請根據節點數值 (Data) 與指示標 (Next Pointer) 的變化回答問題。</p>

                <div style="margin: 20px 0;">
                    <strong>當前鏈表狀態：</strong>
                    <div id="llVizInit" class="ll-viz-container"></div>
                </div>

                <div style="background: #fff8e1; padding: 15px; border-left: 5px solid var(--warning);">
                    <strong>執行操作:</strong> <span id="llOp" style="font-weight: bold; color: #d35400;"></span>
                </div>
                <br>
                <p>操作完成後，鏈表的順序為何？ (請只輸入數值，用逗號分隔)</p>
                <input type="text" id="llAns" placeholder="例如: 10, 30, 50" style="width: 250px;">
                <button class="action-btn check-btn" onclick="checkLL()">檢查</button>
                <button class="action-btn" onclick="genLLQuiz()" style="background-color: #7f8c8d;">下一題 (刷新數值)</button>
                <div id="llFeedback" class="feedback"></div>
            </div>
        </div>

        <div id="ds-content-queue" class="ds-section" style="display:none;">
             <div class="card">
                <h3>循環隊列</h3>
                <p>隊列大小 (Max Size) = 5。初始 Head=-1, Tail=-1 (空)。</p>
                <div style="background: #e8f6f3; padding: 15px; border-left: 5px solid var(--accent); margin-bottom: 15px;">
                    <strong>操作序列:</strong> <span id="queueOps"></span>
                </div>
                Head 指標: <input type="number" id="qHead" style="width:50px"> 
                Tail 指標: <input type="number" id="qTail" style="width:50px">
                <button class="action-btn check-btn" onclick="checkQueue()">檢查</button>
                <button class="action-btn" onclick="genQueueQuiz()" style="background-color: #7f8c8d;">下一題 (刷新數值)</button>
                <div id="queueFeedback" class="feedback"></div>
                <hr>
                <h4>視覺化結果</h4>
                <div id="queueViz" class="queue-viz"></div>
             </div>
        </div>

    </div>
</div>

<script>
    // --- Navigation ---
    function switchModule(modId) {
        document.querySelectorAll('.module').forEach(el => el.classList.remove('active'));
        document.getElementById(modId).classList.add('active');
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        if(modId === 'sorting') loadSortExercise();
        if(modId === 'ds') loadDS('stack');
    }

    function loadDS(type) {
        document.querySelectorAll('.ds-section').forEach(el => el.style.display = 'none');
        document.getElementById('ds-content-' + type).style.display = 'block';
        if(type === 'stack') genStackQuiz();
        if(type === 'll') genLLQuiz();
        if(type === 'queue') genQueueQuiz();
    }

    // ==========================================
    // MODULE 1: SORTING LOGIC (With Real Randomness)
    // ==========================================
    const sortData = {
        bubble: { 
            code: `def bubble_sort(arr):\n    #將陣列由小至大排列\n    n = len(arr)\n    for i in range(<input class="code-input" data-ans="n" id="c1">):\n        for j in range(0, <input class="code-input" data-ans="n-i-1" id="c2">):\n            if arr[j] <input class="code-input" data-ans=">" id="c3"> arr[j+1]:\n                arr[j], arr[j+1] = arr[j+1], arr[j]`, 
            name: "冒泡排序",
            run: (arr, passes) => {
                let a = [...arr];
                let n = a.length;
                for(let i=0; i<passes; i++) {
                    for(let j=0; j<n-i-1; j++) {
                        if(a[j] > a[j+1]) [a[j], a[j+1]] = [a[j+1], a[j]];
                    }
                }
                return a;
            }
        },
        selection: { 
            code: `def selection_sort(arr):\n    for i in range(len(arr)):\n        min_idx = i\n        for j in range(<input class="code-input" data-ans="i+1" id="c1">, len(arr)):\n            if arr[j] <input class="code-input" data-ans="<" id="c2"> arr[min_idx]:\n                min_idx = <input class="code-input" data-ans="j" id="c3">\n        arr[i], arr[min_idx] = arr[min_idx], arr[i]`, 
            name: "選擇排序",
            run: (arr, passes) => {
                let a = [...arr];
                for(let i=0; i<passes; i++) {
                    let min_idx = i;
                    for(let j=i+1; j<a.length; j++) {
                        if(a[j] < a[min_idx]) min_idx = j;
                    }
                    [a[i], a[min_idx]] = [a[min_idx], a[i]];
                }
                return a;
            }
        },
        insertion: { 
            code: `def insertion_sort(arr):\n\n    #將陣列由小至大排列    for i in range(1, len(arr)):\n        key = arr[i]\n        j = i - 1\n        while j >= 0 and key <input class="code-input" data-ans="<" id="c1"> arr[j]:\n            arr[<input class="code-input" data-ans="j+1" id="c2">] = arr[j]\n            j -= 1\n        arr[j+1] = <input class="code-input" data-ans="key" id="c3">`, 
            name: "插入排序",
            run: (arr, passes) => {
                let a = [...arr];
                // Insertion Sort Loop starts at 1. 
                // "Passes" here will simulate execution of outer loop count
                for (let i = 1; i <= passes && i < a.length; i++) {
                    let key = a[i];
                    let j = i - 1;
                    while (j >= 0 && key < a[j]) {
                        a[j + 1] = a[j];
                        j--;
                    }
                    a[j + 1] = key;
                }
                return a;
            }
        }
    };

    let currentSortTrace = { arr: [], ans: [] };

    function loadSortExercise() {
        const type = document.getElementById('sortAlgoSelect').value;
        document.getElementById('codeExerciseContainer').innerHTML = `<pre>${sortData[type].code}</pre>`;
        document.getElementById('codeFeedback').textContent = "";
        generateNewTrace();
    }

    function checkCode() {
        let correct = true;
        document.querySelectorAll('.code-input').forEach(input => {
            if(input.value.replace(/\s/g, '') !== input.dataset.ans) {
                input.style.borderColor = "red"; correct = false;
            } else input.style.borderColor = "#27ae60";
        });
        const fb = document.getElementById('codeFeedback');
        fb.textContent = correct ? "全對！" : "有錯誤，請檢查。";
        fb.className = correct ? "feedback correct" : "feedback incorrect";
    }

    function generateNewTrace() {
        const type = document.getElementById('sortAlgoSelect').value;
        // 1. Generate Random Array
        const arr = Array.from({length: 6}, () => Math.floor(Math.random() * 50) + 1);
        const passes = Math.floor(Math.random() * 2) + 2; // Random 2 or 3 passes

        // 2. Calculate Answer
        const ans = sortData[type].run(arr, passes);
        currentSortTrace = { arr: arr, ans: ans };

        // 3. Update UI
        document.getElementById('traceInitialArray').textContent = `[${arr.join(', ')}]`;
        let qText = "";
        if(type === 'insertion') {
             qText = `當外部迴圈執行了 ${passes} 次後 (即處理完第 ${passes+1} 個元素後)，陣列內容為何？`;
        } else {
             qText = `當外部迴圈執行完第 ${passes} 次 (i=${passes-1}) 後，陣列內容為何？`;
        }
        document.getElementById('traceQuestionText').textContent = qText;
        document.getElementById('traceInput').value = "";
        document.getElementById('traceFeedback').textContent = "";
    }
    
    function checkTrace() {
        const userArr = document.getElementById('traceInput').value.split(/,| /).filter(x=>x).map(Number);
        const fb = document.getElementById('traceFeedback');
        if(JSON.stringify(userArr) === JSON.stringify(currentSortTrace.ans)) {
            fb.textContent = "正確!"; fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。正確答案應為: ${currentSortTrace.ans.join(', ')}`; 
            fb.className = "feedback incorrect";
        }
    }


    // ==========================================
    // MODULE 2: DATA STRUCTURES (With Real Randomness)
    // ==========================================

    let stackQuizData = {};

    function genStackQuiz() {
        const level = document.getElementById('stackDiffSelect').value;
        const qTitle = document.getElementById('stackQTitle');
        const qText = document.getElementById('stackQText');
        const initState = document.getElementById('stackInitState');
        
        // Generate NEW Random Stack
        let stackA = Array.from({length: Math.floor(Math.random()*3)+3}, () => Math.floor(Math.random() * 20) + 1);
        let ansStack = [];
        let finalViz = []; 

        document.getElementById('stackAns').value = "";
        document.getElementById('stackFeedback').textContent = "";
        document.getElementById('stackViz').innerHTML = "";

        if (level === "1") {
            // Level 1: Basic Push/Pop
            qTitle.textContent = "Level 1: 單一堆疊操作";
            let ops = [];
            ansStack = [...stackA];
            
            for(let i=0; i<3; i++) {
                if(ansStack.length > 0 && Math.random() > 0.5) {
                    ansStack.pop();
                    ops.push("Pop()");
                } else {
                    let v = Math.floor(Math.random()*10);
                    ansStack.push(v);
                    ops.push(`Push(${v})`);
                }
            }
            qText.innerHTML = `初始堆疊 (Bottom -> Top): [${stackA.join(', ')}]<br>請依序執行以下操作: <strong>${ops.join(' ➔ ')}</strong>`;
            initState.textContent = "";
            finalViz = [{label: "Stack", data: ansStack}];

        } else if (level === "2") {
            // Level 2: Two Stacks Transfer
            qTitle.textContent = "Level 2: 雙堆疊轉移 (LIFO 特性)";
            qText.innerHTML = `有兩個堆疊: <strong>Stack 1</strong> 與 <strong>Stack 2</strong>。<br>
                               Stack 1 初始內容: [${stackA.join(', ')}] (Top 在右)<br>
                               Stack 2 初始為空。<br><br>
                               <strong>算法操作:</strong><br>
                               <code style="background:#eee; padding:5px; display:block; margin:5px 0;">
                               while (Stack 1 不是空的):<br>
                               &nbsp;&nbsp;temp = Stack 1.Pop()<br>
                               &nbsp;&nbsp;Stack 2.Push(temp)
                               </code>
                               請問程式結束後，<strong>Stack 2</strong> 的內容為何？`;
            initState.textContent = "";
            
            // Logic: Reverse A into B
            ansStack = [...stackA].reverse(); 
            finalViz = [
                {label: "Stack 1 (Empty)", data: []},
                {label: "Stack 2", data: ansStack}
            ];

        } else if (level === "3") {
            // Level 3: Algorithm (Keep Max)
            qTitle.textContent = "Level 3: 堆疊算法";
            qText.innerHTML = `堆疊初始內容: [${stackA.join(', ')}] (Top 在右)<br><br>
                               <strong>算法邏輯:</strong><br>
                               1. 宣告變數 X = 0<br>
                               2. 當堆疊不是空的時，重複執行:<br>
                               &nbsp;&nbsp; a. 取出元素 item = Pop()<br>
                               &nbsp;&nbsp; b. 如果 item > X，則 X = item<br>
                               3. 清空後的堆疊，執行 Push(X)<br><br>
                               請問最終堆疊內剩下什麼？`;
            initState.textContent = "";

            let max = Math.max(...stackA);
            ansStack = [max];
            finalViz = [{label: "Stack", data: ansStack}];
        }

        stackQuizData = { ans: ansStack, vizData: finalViz };
    }

    function checkStack() {
        const input = document.getElementById('stackAns').value;
        const userArr = input.split(/,| /).filter(x => x !== '').map(Number);
        const fb = document.getElementById('stackFeedback');
        
        // Render Viz
        const wrapper = document.getElementById('stackViz');
        wrapper.innerHTML = "";
        
        stackQuizData.vizData.forEach(stackObj => {
            let box = document.createElement('div');
            box.className = 'stack-box';
            let container = document.createElement('div');
            container.className = 'stack-container';
            if (stackObj.data.length === 0) {
                container.innerHTML = "<div style='color:#ccc; font-size:0.8em; margin:auto;'>Empty</div>";
            } else {
                stackObj.data.forEach(val => {
                    let div = document.createElement('div');
                    div.className = 'stack-item';
                    div.textContent = val;
                    container.appendChild(div);
                });
            }
            box.appendChild(container);
            box.appendChild(document.createElement('span')).className = 'stack-label';
            box.lastChild.textContent = stackObj.label;
            wrapper.appendChild(box);
        });

        if (JSON.stringify(userArr) === JSON.stringify(stackQuizData.ans)) {
            fb.textContent = "正確！";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。正確答案是: ${stackQuizData.ans.join(', ')}`;
            fb.className = "feedback incorrect";
        }
    }

    // --- LINKED LIST (NO INDEX) ---
    let llQuizData = {};

    function renderLL(arr, containerId) {
        const con = document.getElementById(containerId);
        con.innerHTML = "";
        arr.forEach(val => {
            let node = document.createElement('div');
            node.className = 'll-node';
            node.innerHTML = `<div class="ll-data">${val}</div><div class="ll-ptr">&bull;</div>`;
            con.appendChild(node);
            let arrow = document.createElement('div');
            arrow.className = 'll-arrow';
            arrow.innerHTML = "&rarr;";
            con.appendChild(arrow);
        });
        let nullTerm = document.createElement('div');
        nullTerm.className = 'll-null';
        nullTerm.textContent = "NULL";
        con.appendChild(nullTerm);
    }

    function genLLQuiz() {
        // Generate Random Linked List
        let len = Math.floor(Math.random() * 3) + 3; // 3 to 5 nodes
        let arr = [];
        for(let k=0; k<len; k++) arr.push(Math.floor(Math.random()*90)+10);
        
        renderLL(arr, 'llVizInit');
        
        const type = Math.random() > 0.5 ? 'insert' : 'delete';
        let question = "", ans = [];

        if (type === 'delete') {
            const target = arr[Math.floor(Math.random() * arr.length)];
            question = `從鏈表中移走數值為 ${target} 的節點`;
            ans = arr.filter(x => x !== target);
        } else {
            const target = arr[Math.floor(Math.random() * arr.length)];
            const newVal = 99;
            question = `在包含數值 ${target} 的節點後方，插入新節點 (數值: ${newVal})`;
            ans = [];
            for(let x of arr) {
                ans.push(x);
                if(x === target) ans.push(newVal);
            }
        }

        llQuizData = { ans: ans };
        document.getElementById('llOp').textContent = question;
        document.getElementById('llAns').value = "";
        document.getElementById('llFeedback').textContent = "";
    }

    function checkLL() {
        const userArr = document.getElementById('llAns').value.split(/,| /).filter(x => x).map(Number);
        const fb = document.getElementById('llFeedback');
        
        if (JSON.stringify(userArr) === JSON.stringify(llQuizData.ans)) {
            fb.textContent = "正確！";
            fb.className = "feedback correct";
        } else {
            fb.textContent = `錯誤。正確順序應為: ${llQuizData.ans.join(' -> ')}`;
            fb.className = "feedback incorrect";
        }
    }

    // --- QUEUE ---
    let queueQuizData = {};
    function genQueueQuiz() {
        const size = 5;
        let head = -1, tail = -1;
        let count = 0;
        let opsDesc = [];
        let q = new Array(size).fill(null);

        // Simulation Loop
        for(let i=0; i<6; i++) {
            let isEnqueue = Math.random() > 0.4;
            if (isEnqueue && count < size) {
                let val = Math.floor(Math.random() * 99);
                if (head === -1) { head = 0; tail = 0; }
                else { tail = (tail + 1) % size; }
                q[tail] = val;
                count++;
                opsDesc.push(`Enqueue(${val})`);
            } else if (!isEnqueue && count > 0) {
                q[head] = null;
                if (head === tail) { head = -1; tail = -1; }
                else { head = (head + 1) % size; }
                count--;
                opsDesc.push(`Dequeue`);
            }
        }

        queueQuizData = { h: head, t: tail, q: q, size: size };
        document.getElementById('queueOps').innerHTML = opsDesc.join(' <span style="color:#aaa">➔</span> ');
        document.getElementById('qHead').value = "";
        document.getElementById('qTail').value = "";
        document.getElementById('queueFeedback').textContent = "";
        document.getElementById('queueViz').innerHTML = "";
    }

    function checkQueue() {
        const uH = parseInt(document.getElementById('qHead').value);
        const uT = parseInt(document.getElementById('qTail').value);
        const fb = document.getElementById('queueFeedback');

        // Draw Viz
        const viz = document.getElementById('queueViz');
        viz.innerHTML = "";
        for(let i=0; i<queueQuizData.size; i++) {
            let cell = document.createElement('div');
            cell.className = 'queue-cell';
            cell.textContent = queueQuizData.q[i] !== null ? queueQuizData.q[i] : "";
            if(queueQuizData.q[i] === null) cell.style.background = "#f4f4f4";

            let lbl = "";
            if(i === queueQuizData.h) lbl += "H ";
            if(i === queueQuizData.t) lbl += "T";
            if(lbl) cell.innerHTML += `<div class="queue-label">${lbl}</div>`;
            
            cell.innerHTML += `<div style="position:absolute; bottom:2px; font-size:10px; color:#aaa;">${i}</div>`;
            viz.appendChild(cell);
        }

        // Logic check: handle empty case where both are -1 (user might input -1 or leave blank)
        let uhVal = isNaN(uH) ? -1 : uH;
        let utVal = isNaN(uT) ? -1 : uT;

        if (uhVal === queueQuizData.h && utVal === queueQuizData.t) {
            fb.textContent = "正確！";
            fb.className = "feedback correct";
        } else {
            let hText = queueQuizData.h === -1 ? "-1 (空)" : queueQuizData.h;
            let tText = queueQuizData.t === -1 ? "-1 (空)" : queueQuizData.t;
            fb.textContent = `錯誤。Head: ${hText}, Tail: ${tText}`;
            fb.className = "feedback incorrect";
        }
    }

    // Init
    loadSortExercise();

</script>

</body>
</html>
